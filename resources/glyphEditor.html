<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">

</head>
<body>

	<input type="file" id="fileinput" /><br>
	<textarea id="inputText" rows="6" cols="60" ></textarea><br>
	<button id="savefile">Save To...</button>   <input placeholder="Type Identification" type="text" id="name" value="myfile" />

<script type="text/javascript">
document.getElementById('fileinput').addEventListener('change', function (e) {
	var f = e.target.files[0];
	if (f) {
		var r = new FileReader();
		r.onload = function (e) {
			var contents = e.target.result;
			alert("Got the file.\n"
				 + "name: " + f.name + "\n"
				 + "type: " + f.type + "\n"
				 + "size: " + f.size + " bytes\n"
				 + "starts with: " + contents.substr(0, contents.indexOf("\n")));
			document.getElementById("inputText").innerText = contents;
		}
		r.readAsText(f);
	} else {
		alert("Failed to load file");
	}
});

document.getElementById('savefile').addEventListener('click', function () {
	var filename = document.getElementById('name').value.replace(/[^a-zA-Z0-9_$]/g, '_') + ".h";
	var data = document.getElementById("inputText").innerText;
	alert("Ready to save to" + filename);
	if (data.length < 10) return;
	
	var blobObject = new Blob([data], {
			type: 'text/plain'
		});

	if (window.navigator.msSaveBlob) {
		window.navigator.msSaveBlob(blobObject, filename);
	} else {
		var a = document.createElement("a");
		a.setAttribute("href", URL.createObjectURL(blobObject));
		a.setAttribute("download", filename);
		if (document.createEvent) {
			var event = document.createEvent('MouseEvents');
			event.initEvent('click', true, true);
			a.dispatchEvent(event);
		} else {
			a.click();
		}
	}
});
</script>

</body>
